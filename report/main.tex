\documentclass[12pt]{ucthesis}

\usepackage{etex}
\usepackage[morefloats=125]{morefloats}
\usepackage[hyphens]{url}
\usepackage{subfig}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[letterpaper]{geometry}
\usepackage[overload]{textcase}
\usepackage{color}
\usepackage[nonumberlist,toc]{glossaries}
\usepackage{wrapfig}
\usepackage{morefloats}
\usepackage{float}
\usepackage{listings}
\usepackage{makecell}
\usepackage{appendix}
\usepackage[]{algorithm2e}
\usepackage{titlesec}
\usepackage[breaklinks=true,hidelinks,pdfusetitle]{hyperref}
\usepackage{cleveref}
\usepackage{ifthen}

\usepackage{siunitx}
\usepackage{pdfpages}
\usepackage{pdflscape}
\usepackage{xcolor}
%\usepackage{setspace}

% Table related packages
%\usepackage{longtable}
%\usepackage{tabularx}
\usepackage{ltxtable}
\captionsetup[longtable]{labelfont=bf,textfont=bf}
\usepackage{booktabs}
\usepackage{ragged2e}  % for '\RaggedRight' macro (allows hyphenation)
\newcolumntype{Y}{>{\RaggedRight\arraybackslash}X} 

\makeindex
\makeglossaries

% Shrink the size of headers
\titleformat{\chapter}[display]
        {\normalfont\normalsize\centering}
        {\ifthenelse{\equal{\thechapter}{A}}{APPENDICES\\[4.3ex]}{}\chaptertitlename\ \thechapter}
        {0pt}{\normalsize\uppercase}
\titlespacing*{\chapter}{0pt}{-20pt}{4.3ex plus .2ex}


\titleformat*{\section}{\normalsize\bfseries}
\titleformat*{\subsection}{\small\bfseries}
\titleformat*{\subsubsection}{\small\bfseries}
\titleformat*{\paragraph}{\small\bfseries}
\titleformat*{\subparagraph}{\small\bfseries}

% Python formatting ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.8}
\definecolor{deepred}{rgb}{0.8,0,0}
\definecolor{deepgreen}{rgb}{0,0.8,0}
\definecolor{gray}{rgb}{0.4,0.4,0.4}

\usepackage{linegoal}

% Fixes inline wrapping issue, see https://tex.stackexchange.com/questions/56361/avoid-linebreak-in-lstinline-if-possible
\newsavebox{\mylisting}
\makeatletter
\newcommand{\lstInline}[2][,]{%
  \begingroup%
  \lstset{#1}% Set any keys locally
  \begin{lrbox}{\mylisting}\lstinline!#2!\end{lrbox}% Store listing in \mylisting
  \setlength{\@tempdima}{\linegoal}% Space left on line.
  \ifdim\wd\mylisting>\@tempdima\hfill\\\fi% Insert line break
  \lstinline!#2!% Reset listing
  \endgroup%
}
\makeatother

% C style
\newcommand\cstyle{\lstset{
	language=C,
	basicstyle=\ssp\ttfamily\scriptsize,
	frame=tb, % draw a frame at the top and bottom of the code block
 	tabsize=3, % tab space width
	showstringspaces=false, % don't mark spaces in strings
	numbers=left, % display line numbers on the left
	commentstyle=\color{deepgreen}, % comment color
	keywordstyle=\color{deepblue}, % keyword color
	stringstyle=\color{deepred}, % string color
	breaklines=true
}}

% C style for inline
\newcommand\cstyleinline{\lstset{
	language=C,
	basicstyle=\ssp\ttfamily,
 	tabsize=3, % tab space width
	showstringspaces=false, % don't mark spaces in strings
	commentstyle=\color{deepgreen}, % comment color
	keywordstyle=\color{deepblue}, % keyword color
	stringstyle=\color{deepred}, % string color
	breaklines=true
}}

% Command for inline C
\newcommand\cinline[1]{{\cstyleinline\lstInline{#1}}}

% C environment
\lstnewenvironment{clisting}[1][]
{
	\cstyle
	\lstset{#1}
}
{}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
		language=Python,
		basicstyle=\ssp\ttfamily\scriptsize,
		otherkeywords={self},             % Add keywords here
		keywordstyle=\color{deepblue},
		emph={MyClass,__init__},          % Custom highlighting
		emphstyle=\color{deepred},    % Custom highlighting style
		stringstyle=\color{deepgreen},
		numbers=left,
		commentstyle=\color{gray}, % comment color
		frame=tb,                         % Any extra options here
		showstringspaces=false,            % 
		tabsize=3, % tab space width
		breaklines=true
}}

% Python style for inline
\newcommand\pythonstyleinline{\lstset{
		language=Python,
		basicstyle=\ssp\ttfamily,
		otherkeywords={self},             % Add keywords here
		keywordstyle=\color{deepblue},
		emph={MyClass,__init__},          % Custom highlighting
		emphstyle=\color{deepred},    % Custom highlighting style
		stringstyle=\color{deepgreen},
		commentstyle=\color{gray}, % comment color
		showstringspaces=false,            % 
		tabsize=3, % tab space width
		breaklines=true
}}

% Python environment
\lstnewenvironment{python}[1][]
{
	\pythonstyle
	\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
		\pythonstyle
		\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyleinline\lstinline!#1!}}



\bibliographystyle{abbrv}

\setlength{\parindent}{0.25in} \setlength{\parskip}{6pt}
\geometry{verbose,nohead,tmargin=1in,bmargin=1in,lmargin=1.5in,rmargin=1in}
\setcounter{tocdepth}{2}

% Different font in captions (single-spaced, bold) ------------
\newcommand{\captionfonts}{\small\bf\ssp}

\newcommand{\mycaption}[2]{\caption[#1 --- #2]{#1 --- #2}}

\makeatletter  % Allow the use of @ in command names
\long\def\@makecaption#1#2{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{{\captionfonts #1: #2}}%
  \ifdim \wd\@tempboxa >\hsize
    {\captionfonts #1: #2\par}
  \else
    \hbox to\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}
\makeatother   % Cancel the effect of \makeatletter
% ---------------------------------------

% Define Appendix refs
\crefname{app}{appendix}{appendices}
\Crefname{app}{Appendix}{Appendices}

% Rename Table of Listings
\renewcommand{\lstlistlistingname}{LIST OF LISTINGS}
    
\begin{document}

% Declarations for Front Matter
\input{frontmatter}

\maketitle

\begin{frontmatter}

% Custom made for Cal Poly (by Mark Barry, modified by Andrew Tsui).
\copyrightpage

% Custom made for Cal Poly (by Andrew Tsui).
\committeemembershippage

\begin{abstract}
\input{abstract}
\end{abstract}

\begin{acknowledgements}
\input{acknowledgements}
\end{acknowledgements}

\tableofcontents

\listoftables

\listoffigures
\newpage
\addcontentsline{toc}{chapter}{{LIST OF LISTINGS}}
\lstlistoflistings

% Add CHAPTER into table of contents.
\addtocontents{toc}{%
   \noindent CHAPTER
}

\end{frontmatter}

\pagestyle{plain}

\renewcommand{\baselinestretch}{1.66}

\input{chapter-outline}

\nocite{*}
\bibliography{bibliography}

% Indents Appendix in Table of Contents
\makeatletter
\addtocontents{toc}{\let\protect\l@chapter\protect\l@section}
\makeatother

% Hack to make Appendices to appear in Table of Contents
\addtocontents{toc}{%
   \noindent APPENDICES
}
\begin{appendices}
\input{appendix-outline}
\end{appendices}

\end{document}
